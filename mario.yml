# Tasks

build:
  - docker build -t opentrialsrobot/scraper .

deploy:
  - ${CI?"Deployment is avaiable only on CI/CD server"}
  - docker login
    -e $OPENTRIALS_DOCKER_EMAIL
    -u $OPENTRIALS_DOCKER_USER
    -p $OPENTRIALS_DOCKER_PASS
  - tutum login
    -u $OPENTRIALS_DOCKER_USER
    -p $OPENTRIALS_DOCKER_PASS
  - docker push opentrialsrobot/scraper
  - tutum stack inspect scraper ||
    tutum stack create --sync -f docker-compose.yml -n scraper
  - tutum stack update --sync -f docker-compose.yml scraper

test:
  - pylama scraper
  - py.test tests
